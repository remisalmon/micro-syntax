filetype: bash

detect:
  filename: "\\.(ba)?sh$"
  header: "^#!.*/(env +)?bash( |$)"

rules:
  # https://www.gnu.org/software/bash/manual/bash.html#Index-of-Shell-Builtin-Commands
  - identifier: ":(\\s|$)"
  - identifier: "\\.\\s"
  - identifier: "(\\[\\s|\\s\\])"

  - identifier: "\\b(alias|bg|bind|break|builtin|caller|cd|command|compgen|complete|compopt|continue|declare|dirs|disown|echo|enable|eval|exec|exit|export|fc|fg|getopts|hash|help|history|jobs|kill|let|local|logout|mapfile|popd|printf|pushd|pwd|read|readarray|readonly|return|set|shift|shopt|source|suspend|test|times|trap|type|typeset|ulimit|umask|unalias|unset|wait)\\b"

  # https://www.gnu.org/software/bash/manual/bash.html#Index-of-Shell-Reserved-Words
  - statement: "(! |\\[\\[ | \\]\\]|\\{ |; \\})"

  - statement: "\\b(case|do|done|elif|else|esac|fi|for|function|if|in|select|then|time|until|while)\\b"

  # https://www.gnu.org/software/bash/manual/bash.html#Parameter-and-Variable-Index
  - constant: "\\$[!#$*0?@_-]"

  # https://www.gnu.org/software/bash/manual/bash.html#index-control-operator
  # https://www.gnu.org/software/bash/manual/bash.html#index-metacharacter
  # https://www.gnu.org/software/bash/manual/bash.html#Command-Substitution
  # https://www.gnu.org/software/bash/manual/bash.html#Process-Substitution
  # https://www.gnu.org/software/bash/manual/bash.html#Arithmetic-Expansion
  - special: "(\\||&|;|\\(|\\)|<|>|\\$)"

  # https://www.gnu.org/software/bash/manual/bash.html#Brace-Expansion
  - special: "[{,}]"

  # https://www.gnu.org/software/bash/manual/bash.html#Tilde-Expansion
  - special: "~"

  # https://www.gnu.org/software/bash/manual/bash.html#Shell-Parameter-Expansion
  - constant: "\\$[A-Za-z_]\\w*"
  - constant: "\\$\\{[^}]+\\}"

  # https://www.gnu.org/software/bash/manual/bash.html#Quoting-1
  - constant.string:
      start: "\""
      end: "\""
      skip: "\\\\."
      rules: []

  - constant.string:
      start: "'"
      end: "'"
      rules: []

  # https://www.gnu.org/software/bash/manual/bash.html#Comments
  - comment:
      start: "(^|\\s)#"
      end: "$"
      rules: []

  # https://www.gnu.org/software/bash/manual/bash.html#Here-Documents
  - default:
      start: "<<(-)?EO."
      end: "EO."
      rules: []
